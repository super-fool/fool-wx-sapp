# 授权模型 Auth

最常见的授权就是[用户登录](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html).

小程序的登录与微信登录毫无关系. 小程序属于第三方应用, 微信是小程序的一个平台. 

小程序登录方式:
- 使用微信快捷登录: 可以享受微信带来的优势:
  - 生态优势: 融入完善的微信生态系统,比如订阅消息, 微信支付等; 
  - 用户体验: 可以享受一键登录的快捷, 对比输入验证码更为便捷;
  - 产品策略: 可以根据用户的来源, 制定特殊的铲平策略, 比如在微信中发放优惠券等; 
- 使用邮箱,手机号等方式登录: 小程序属于第三方应用, 完全可以根据自己的产品策略订制相应的登录方式

小程序六个术语:
- code: 临时登录凭证, 调用login获取,通过code+appid+appsecret请求开发者服务器, 通过开发者服务器请求微信服务器获取session_key 和 openid, 有效期为5分钟, 并且只能使用一次进行请求, 所以每次的登录都需要获取一次code.
- appid: 小程序id, 小程序的开发管理-开发设置中获取, 标记了小程序的唯一性, 等同于网站的URL(经过备案的)
- appsecret: 小程序密钥, 用于加密和身份验证, 包含此信息的请求, 只能通过开发者服务器去请求微信接口服务, 降低了被泄漏的可能性.
- openid: 登录成功后用户对于该小程序的唯一ID, 
- unionid: 微信号的唯一ID
- session_key: 对用户数据加密签名的密钥, 理解为用户数据的**绿卡**, 所有涉及访问微信接口的信息请求都必须带上它.
- token: 登录态令牌, 在开发者服务器中, 由(openid + session_key) + 公钥  = token, 然后传给客户端, 由于涉及密钥解密,所以在客户端是安全的, 只有通过服务端的密钥才可以解密.

由于安全考虑, 一些微信接口只能通过开发者服务器进行发起, 无法通过小程序直接请求. 开发者服务器的工作是**处理一些安全敏感的请求**. 

openid 和 unionid的关系, unionid 代表这微信号的唯一ID, openid代表着微信号针对于某个小程序/公众号的唯一ID, 可以理解为`openid(某艺人的某处房子的钥匙) = unionid(某艺人的身份证) + appid(某艺人的某处房产证)`

## OAuth 2.0

在OA标准协议中, 小程序, 微信, 用户 分别在不同的功能中承担了不同的角色:

- Resource Owner: 资源拥有者, 永远是用户.
- Resource Source: 微信服务器
- Third-party Application: 小程序
- User Agent: 微信
- Authorization Server: 微信服务器
- Http Service: 微信服务器